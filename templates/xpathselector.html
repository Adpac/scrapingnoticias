{{texto|safe}}
{% set reglainterna={'idregla':""} %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/sweetalert2/6.5.6/sweetalert2.min.css">
<script src="https://cdn.jsdelivr.net/sweetalert2/6.5.6/sweetalert2.min.js"></script>
<div class="xpathmenu" marcar="nopintar" id="xpathmenu">
    <form marcar="nopintar"  method="post" id="formreglas" action="{{url_for('validarurlcategoria')}}">
        <input type="hidden" name="urlprincipal" value="{{url}}">
        <input type="hidden" name="categoria" value="{{categoria}}">
        <input type="hidden" name="editarregla" value="" id="reglaedit">
        <input type="hidden" name="cambiosre" value="false" id="cambiosre">
        <div class="selector" marcar="nopintar"></div> 
        {% if listareglas|length > 0 %}
        <select marcar="nopintar" id="selregla" name="reglaseleccionada">
            <option marcar="nopintar" value="ninguno" xptitu="" xpres="" xpimg="" xpdesimg="" xpred="" xpfecha="" xparr="" xphas="" >Regla sin seleccionar</option>
            {% for regla in listareglas %}
           
            
            {% if editar and idregla|string==regla['_id']|string %}
            <option marcar="nopintar" value="{{regla['_id']}}"  xpurl="{{regla['xpathurl']}}" xptitu="{{regla['xpathtitular']}}" xpfecha="{{regla['xpathfecha']}}" xpimg="{{regla['xpathimg']}}" xpred="{{regla['xpathredactor']}}"  xpdes="{{regla['xpathdescripcion']}}" ri="{{regla['reglainterna']}}" selected >
                Regla {{loop.index}} 
            </option>
            {% if reglainterna.update({'idregla':regla['reglainterna']|string}) %}{% endif %}
            {% else %}
            <option marcar="nopintar" value="{{regla['_id']}}"  xpurl="{{regla['xpathurl']}}" xptitu="{{regla['xpathtitular']}}" xpfecha="{{regla['xpathfecha']}}" xpimg="{{regla['xpathimg']}}" xpred="{{regla['xpathredactor']}}"  xpdes="{{regla['xpathdescripcion']}}" ri="{{regla['reglainterna']}}" >
                Regla {{loop.index}}
            </option>
            {% endif %}
            {% endfor %}
        </select>
        {%else%}
        <select marcar="nopintar" id="selregla" name="reglaseleccionada" hidden>
            <option marcar="nopintar" value="ninguno" xptitu="" xpres="" xpimg="" xpdesimg="" xpred="" xpfecha="" xparr="" xphas="" >Regla sin seleccionar</option>
        </select>

        {%endif%}
        <table marcar="nopintar" width="100%">
            <tbody marcar="nopintar">

            <tr marcar="nopintar">
                <td marcar="nopintar">Seleccione las urls de las diferentes noticias</td>
                <td marcar="nopintar"><button  type="button" onclick="seleccionarcampo(1)" id="pintartag1" marcar="nopintar">Seleccionar</button></td>
                <td marcar="nopintar"> <input type="text" marcar="nopintar" name="inputurl"  id="input1" onkeyup="pintarelementos(1)" required></td>
                <td> 
                                            
                    <div class="dropdown" marcar="nopintar" >
                        <button type="button" onclick="mostrarlista(1)" class="dropbtn" marcar="nopintar" id="btnlista">Ver seleccion</button>
                        <div id="myDropdown1" class="dropdown-content " marcar="nopintar">

                        </div>
                    </div>
                </td>
                <td marcar="nopintar"><div id="datos1" class="datosxpath"></div></div></td>
            </tr>
            <tr marcar="nopintar">
                <td marcar="nopintar">Seleccione los titulares de las noticias</td>
                <td marcar="nopintar"><button  type="button" onclick="seleccionarcampo(2)" id="pintartag2" marcar="nopintar">Seleccionar</button></td>
                <td marcar="nopintar"> <input type="text" marcar="nopintar" name="inputtitular"  id="input2" onkeyup="pintarelementos(2)"></td>
                <td> 
                                            
                    <div class="dropdown" marcar="nopintar" >
                        <button type="button" onclick="mostrarlista(2)" class="dropbtn" marcar="nopintar" id="btnlista">Ver seleccion</button>
                        <div id="myDropdown2" class="dropdown-content " marcar="nopintar">
                        </div>
                    </div>
                </td>
                <td marcar="nopintar"><div id="datos2" class="datosxpath"></div></div></td>
            </tr>
            <tr marcar="nopintar">
                <td marcar="nopintar">Seleccione las fechas de cada noticia </td>
                <td marcar="nopintar"><button  type="button" onclick="seleccionarcampo(3)" id="pintartag3" marcar="nopintar">Seleccionar</button></td>
                <td marcar="nopintar"> <input type="text" marcar="nopintar" name="inputfecha"  id="input3" onkeyup="pintarelementos(3)"></td>
                <td> 
                                            
                    <div class="dropdown" marcar="nopintar" >
                        <button type="button" onclick="mostrarlista(3)" class="dropbtn" marcar="nopintar" id="btnlista">Ver seleccion</button>
                        <div id="myDropdown3" class="dropdown-content " marcar="nopintar">
                        </div>
                    </div>
                </td>
                <td marcar="nopintar"><div id="datos3" class="datosxpath"></div></div></td>
            </tr>
            <tr marcar="nopintar">
                <td marcar="nopintar">Seleccione las imagenes de las noticias</td>
                <td marcar="nopintar"><button  type="button" onclick="seleccionarcampo(4)" id="pintartag4" marcar="nopintar">Seleccionar</button></td>
                <td marcar="nopintar"> <input type="text" marcar="nopintar" name="inputimg"  id="input4" onkeyup="pintarelementos(4)"></td>
                <td> 
                                            
                    <div class="dropdown" marcar="nopintar" >
                        <button type="button" onclick="mostrarlista(4)" class="dropbtn" marcar="nopintar" id="btnlista">Ver seleccion</button>
                        <div id="myDropdown4" class="dropdown-content " marcar="nopintar">
                        </div>
                    </div>
                </td>
                <td marcar="nopintar"><div id="datos4" class="datosxpath"></div></div></td>
            </tr>
            <tr marcar="nopintar">
                <td marcar="nopintar">Seleccione a los redactores de las noticias</td>
                <td marcar="nopintar"><button  type="button" onclick="seleccionarcampo(5)" id="pintartag5" marcar="nopintar">Seleccionar</button></td>
                <td marcar="nopintar"> <input type="text" marcar="nopintar" name="inputredactor"  id="input5" onkeyup="pintarelementos(5)"></td>
                <td> 
                                            
                    <div class="dropdown" marcar="nopintar" >
                        <button type="button" onclick="mostrarlista(5)" class="dropbtn" marcar="nopintar" id="btnlista">Ver seleccion</button>
                        <div id="myDropdown5" class="dropdown-content " marcar="nopintar">
                        </div>
                    </div>
                </td>
                <td marcar="nopintar"><div id="datos5" class="datosxpath"></div></div></td>
            </tr>
            <tr marcar="nopintar">
                <td marcar="nopintar">Seleccione las descripciones de las noticias</td>
                <td marcar="nopintar"><button  type="button" onclick="seleccionarcampo(6)" id="pintartag6" marcar="nopintar">Seleccionar</button></td>
                <td marcar="nopintar"> <input type="text" marcar="nopintar" name="inputdescripcion"  id="input6" onkeyup="pintarelementos(6)"></td>
                <td> 
                                            
                    <div class="dropdown" marcar="nopintar" >
                        <button type="button" onclick="mostrarlista(6)" class="dropbtn" marcar="nopintar" id="btnlista">Ver seleccion</button>
                        <div id="myDropdown6" class="dropdown-content " marcar="nopintar">
                        </div>
                    </div>
                </td>
                <td marcar="nopintar"><div id="datos6" class="datosxpath"></div></div></td>
            </tr>
            <tr marcar="nopintar">
                <td>
                        {% if reglainterna.idregla =="" %}
                        <label id="checkform"><input type="checkbox" id="cbox1" name="continuarform" value="continuarform"> Deseo ingresar a la Url de la noticia y seleccionar datos </label><br>
                        {% else %}
                        <label id="checkform"><input type="checkbox" id="cbox1" name="continuarform" value="continuarform"> Deseo modificar las reglas de la noticia al momento de ingresar a la url</label><br>
                        {% endif %}     
                </td>
            </tr>
            </tbody>

        </table>
        <button id="inputaceptar" marcar="nopintar" type="button" name="enviar" id="btnsubmit" onclick="validarform()">Aceptar</button>
  
        <button  marcar="nopintar" id="btncambiarposicion" type="button" onclick="cambiarposicion()">Pasar Abajo</button>
    </form>
    
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="/static/scripts/selectorxpath.js" ></script>           
<script>
    var editar=("{{ editar }}")
    console.log("Editar: "+editar)
    if(editar=="True"){
        actualizarseleccion()
    }
    //Script para la seleccion de reglas
    jQuery('#selregla').change(function(){ 
    var value = jQuery(this).val();
    var seleccion=jQuery(this).find('option:selected');
    jQuery("#input1").val(seleccion.attr("xpurl"))
    jQuery("#input2").val(seleccion.attr("xptitu"))
    jQuery("#input3").val(seleccion.attr("xpfecha"))
    jQuery("#input4").val(seleccion.attr("xpimg"))
    jQuery("#input5").val(seleccion.attr("xpred"))
    jQuery("#input6").val(seleccion.attr("xpdes"))
    if(seleccion.attr("ri")!=""){
      
        jQuery("#checkform").html('<input type="checkbox" id="cbox1" name="continuarform" value="continuarform"> Deseo modificar las reglas de la noticia al momento de ingresar a la url')
    }
    console.log("seleccionando regla....")
    pintarelementos(1);
    pintarelementos(2);
    pintarelementos(3);
    pintarelementos(4);
    pintarelementos(5);
    pintarelementos(6);



});
function actualizarseleccion(){
    var value = jQuery('#selregla').val();
    var seleccion=jQuery('#selregla').find('option:selected');
    jQuery("#input1").val(seleccion.attr("xpurl"))
    jQuery("#input2").val(seleccion.attr("xptitu"))
    jQuery("#input3").val(seleccion.attr("xpfecha"))
    jQuery("#input4").val(seleccion.attr("xpimg"))
    jQuery("#input5").val(seleccion.attr("xpred"))
    jQuery("#input6").val(seleccion.attr("xpdes"))
    console.log("seleccionando regla....")
    pintarelementos(1);
    pintarelementos(2);
    pintarelementos(3);
    pintarelementos(4);
    pintarelementos(5);
    pintarelementos(6);

    sedetectaroncambios=false
}
function actualizar(){
    pintarelementos(1);
    pintarelementos(2);
    pintarelementos(3);
    pintarelementos(4);
    pintarelementos(5);
    pintarelementos(6);

}
function cambioregla(codform){
    //Retornara verdadero en caso de que se detecten cambios entre la regla seleccionada y los valoresdentro de esta
    retornar=false;
    if(codform!="ninguno"){
        var seleccion=jQuery('#selregla').find('option:selected');
        if(seleccion.attr("xpurl")!=jQuery("#input1").val() ||seleccion.attr("xptitu")!=jQuery("#input2").val() || seleccion.attr("xpfecha")!=jQuery("#input3").val() ||seleccion.attr("xpimg")!=jQuery("#input4").val() || seleccion.attr("xpred")!=jQuery("#input5").val() || seleccion.attr("xpdes")!=jQuery("#input6").val()){
            retornar=true;
        }
    }
    return retornar
}
function validarform(){
    var reglasel=document.getElementById("selregla");
    var form = jQuery("#formreglas")
    var checkform=document.getElementById("cbox1")
    console.log("reglasel"+reglasel)
    if(cambioregla(reglasel.value)){
        jQuery("#cambiosre").val("true")
        if(reglasel!=null && !checkform.checked  ){
        swal({
            title: "¿Desea modificar la regla actual?",
            text: "Recuerde que esta regla es utilizada por diferentes enlaces, si selecciona crear nueva regla solo se aplicaran los cambios a esta URL ",
            showCancelButton: true,
            showCloseButton: true,
            confirmButtonText: 'Editar regla',
            cancelButtonText: `Crear nueva regla`,
       
          })
          .then(function(){
                jQuery("#reglaedit").val(reglasel.value)
                swal("Se modificara la regla");
                form.submit();
          },function(dismiss){
            if(dismiss == 'cancel') {
                jQuery("#reglaedit").val(reglasel.value)
                jQuery('#selregla').val("ninguno");
              swal("Se creara una nueva regla");
              form.submit();
            }
          });
    }else{

        form.submit();
    }
    }else{
        form.submit();
    }

    
}
</script>                       




